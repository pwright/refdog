- name: Site
  yaml_example: |
    apiVersion: skupper.io/v1alpha1
    kind: Site
    metadata:
      name: east
      namespace: east
    spec:
      ingress: loadbalancer
      enableConsole: true
  cli_example: |
    skupper init --site-name east --ingress loadbalancer --enable-console
  options:
    - name: name
      type: string
      description: |
        A name of your choice for the Skupper site.
    - name: createNetworkPolicy
      type: boolean
      description: |
        Create network policy to restrict access to Skupper services
        exposed through this site to the pods currently in the
        namespace.
  groups:
    - title: Ingress options
      options:
        - name: ingress
          default: |
            "route" if OpenShift, else loadbalancer
          type: string
          choices: [route, loadbalancer, nodeport, nginx-ingress-v1, contour-http-proxy, ingress, none]
          description: |
            Select the method for cluster ingress.  Determines how XXX
            is exposed outside of the cluster.
        - name: ingressHost
          default: null
          type: string
          description: |
            The hostname or alias by which the ingress route or proxy
            can be reached.

            The host through which the node is accessible when using
            nodeport as ingress.
        - name: loadBalancerIP
          type: string
          description: |
            The load balancer IP address that will be used for XXX, if
            supported by the cloud provider.
        - name: ingressOptions
          type: XXX
          description: XXX xxxIngress, xxxIngressHost, xxxLoadBalancerIP (console, controller, router)
    - title: Console options
      options:
        - name: enableConsole
          type: boolean
          description: |
            Enable skupper console must be used in conjunction with
            '--enable-flow-collector' flag
        - name: consoleAuth
          default: internal
          type: string
          choices: [internal, openshift, unsecured]
          description: |
            The user authentication method for the console.
        - name: consoleUser
          default: admin
          type: string
          description: |
            The console username when using internal authentication.
        - name: consolePassword
          default: "[generated]"
          type: string
          description: |
            The console password when using internal authentication.
    - title: Flow collector options
      options:
        - name: enableFlowCollector
          type: boolean
          description: |
            Enable cross-site flow collection for the application network
        - name: flowCollectorRecordTTL
          default: 30m
          type: duration
          description: |
            Time after which terminated flow records are deleted,
            i.e. those flow records that have an end time set.
    - title: Router options
      options:
        - name: routerMode
          default: interior
          type: string
          choices: [interior, edge]
          description: |
            The role of the router in the router topology.  Interior
            routers do XXX.  Edge routers only do YYY.
        - name: routerLogging
          default: info
          type: string
          choices: [trace, debug, info, notice, warning, error]
          description: |
            Logging settings for the router.
        - name: routerDebugMode
          type: string
          choices: [asan, gdb]
          description: |
            Enable debug mode for the router.
        - name: routers
          type: integer
          description: |
            The number of router replicas to start.
    - title: Skupper resource options
      options:
        - name: resourceLimits
          type: XXX
          description: XXX requests and limits
        - name: resourceAnnotations
          type: XXX
          description: XXX
        - name: resourceLabels
          type: XXX
          description: XXX
        - name: resourceNodeAffinity
          type: XXX
          description: XXX
        - name: resourcePodAffinity
          type: XXX
          description: XXX
- name: Link
  yaml_example: |
    apiVersion: skupper.io/v1alpha1
    kind: Link
    metadata:
      name: link-to-west
      namespace: east
    spec:
      secret: west-token-1
  cli_example: |
    skupper link create west-token-1.yaml --name link-to-west
  options:
    - name: name
      default: "[Generated]"
      type: string
      description: |
        An optional name for the link.
    - name: secret
      type: string
      description: |
        The path to the file or resource that contains the token data.
    - name: cost
      default: 1
      type: integer
      description: |
        The weighted cost of routing connections and requests over
        this link.  The cost of this link relative to others, plus the
        current backlog at each endpoint and the number of hops
        required, determines how traffic is routed across the network.
- name: Token
  yaml_example: |
    apiVersion: skupper.io/v1alpha1
    kind: Token
    metadata:
      name: west-token-1
      namespace: west
    spec:
      secret: west-token-1
      expiry: 1h
  cli_example: |
    skupper token create west-token-1.yaml --expiry 1h
  options:
    - name: name
      default: "[Generated]"
      type: string
      description: |
        The name of the token.
    - name: secret
      type: string
      description: |
        The path to the file or resource that is to contain the
        generated token data.
    - name: type
      default: claim
      type: string
      choices: [claim, cert]
      description: |
        The type of token to create.
    - name: expiry
      default: 15m
      type: duration
      description: |
        The expiration time for the token.  Valid only if the token
        type is claim.
    - name: password
      default: [Generated]
      type: string
      description: |
        A password for the token.  Valid only if the token type is
        claim.
    - name: uses
      trouble: |
        "Uses" sounds like it could mean "current uses".  "UseLimit"
        would be unambiguous.
      default: 1
      type: integer
      description: |
        The max number of uses the token allows.  Valid only if
        the token type is claim.
    - name: authName
      trouble: What does this mean?  I feel a more relatable attribute might be something linke remote-site-name.
      default: skupper (?)
      type: string
      description: |
        Provide a specific identity as which connecting skupper
        installation will be authenticated.
- name: ProvidedService
  yaml_example: |
    apiVersion: skupper.io/v1alpha1
    kind: ProvidedService
    metadata:
      name: backend
      namespace: east
    spec:
      target: deployment/backend
      ports:
        - port: 8080
          targetPort: 9090
  cli_example: |
    #
    # Current
    #
    skupper service create backend 8080
    skupper service bind backend deployment/backend --target-port 9090
    #
    # Proposed (general purpose form)
    #
    skupper provided-service create backend deployment/backend
    skupper provided-service create-port backend 8080 --target-port 9090
    #
    # Proposed (simplified form for the common case)
    #
    skupper provide backend:8080 deployment/backend --target-port 9090
  options:
    - name: name
      type: string
      description: |
        The service name.
    - name: ports
      type: list
      description: |
        A list of ports.
    - name: target
      type: string
      description: |
        The workload that implements this service.
    - name: enableIngress
      trouble: |
        Collision with other meanings of "ingress".  I want a note
        here that says that some future iteration might include a
        third state.
      default: Always
      type: string
      choices: [Always, Never]
      description: |
        Determines whether access to the Skupper service is enabled in
        this site.
    - name: publishNotReadyAddresses
      type: boolean
      description: |
        If specified, skupper will not wait for pods to be ready
- name: ProvidedPort
  yaml_example: |
    XXX
  cli_example: |
    #
    # Current
    #
    skupper service bind backend deployment/backend --target-port 9090
    #
    # Proposed (general purpose form)
    #
    skupper provided-service create-port backend 8080 --target-port 9090
  options:
    - name: port
      type: integer
      description: |
        The port number.
    - name: name
      default: The value of port
      type: string
      description: |
        The port name.
    - name: protocol
      default: tcp
      type: string
      choices: [tcp, http, http2]
      description: |
        The protocol mapping in use for this service address.
    - name: targetPort
      default: The value of port
      type: integer
      description: |
        The port the target is listening on (you can also use
        colon to map source-port to a target-port).
    - name: bridgeImage
      type: string
      description: |
        The image to use for a bridge running external to the
        skupper router
  groups:
    - title: TLS options
      options:
        - name: generateTLSSecrets
          trouble: |
            This sounds like it generates secrets, but the description
            says it enables encryption.  So why not "enableTLS"?
          type: boolean
          description: |
            If specified, the service communication will be encrypted using TLS
        - name: tlsCert
          type: string
          description: |
            The Kubernetes secret name with custom certificates to encrypt
            the communication using TLS.
        - name: tlsTrust
          type: string
          description: |
            The Kubernetes secret name with the CA to expose the service
            over TLS.
- name: RequiredService
  yaml_example: |
    apiVersion: skupper.io/v1alpha1
    kind: RequiredService
    metadata:
      name: backend
      namespace: west
    spec:
      ports:
        - port: 8080
  cli_example: |
    #
    # Current
    #
    skupper service create backend 8080
    #
    # Proposed (general purpose form)
    #
    skupper required-service create backend
    skupper required-service create-port backend 8080
    #
    # Proposed (simplified form for the common case)
    #
    skupper require backend:8080
  options:
    - name: name
      type: string
      description: |
        The service name.
    - name: ports
      type: list
      description: |
        A list of ports.
    - name: publishNotReadyAddresses
      type: boolean
      description: |
        If specified, skupper will not wait for pods to be ready
- name: RequiredPort
  extends: Port
  yaml_example: |
    XXX
  cli_example: |
    #
    # Current
    #
    skupper service bind backend deployment/backend --target-port 9090
    #
    # Proposed (general purpose form)
    #
    skupper required-service create-port backend 8080 --target-port 9090
- name: Port
  hidden: true
  options:
    - name: port
      type: integer
      description: |
        The port number.
    - name: name
      default: The value of port
      type: string
      description: |
        The port name.
    - name: protocol
      default: tcp
      type: string
      choices: [tcp, http, http2]
      description: |
        The protocol mapping in use for this service address.

        XXX Consequences for observability.
    - name: bridgeImage
      type: string
      description: |
        The image to use for a bridge running external to the
        skupper router
  groups:
    - title: TLS options
      options:
        - name: generateTLSSecrets
          trouble: |
            This sounds like it generates secrets, but the description
            says it enables encryption.  Does it enable encryption?
          type: boolean
          description: |
            If specified, the service communication will be encrypted using TLS
        - name: tlsCert
          type: string
          description: |
            The Kubernetes secret name with custom certificates to encrypt
            the communication using TLS.
        - name: tlsTrust
          type: string
          description: |
            The Kubernetes secret name with the CA to expose the service
            over TLS.
