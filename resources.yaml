- name: site
  yaml_example: |
    version: 1
    site:
      name: east
      ingress: none
      router-cpu-limit: 2
  kubernetes_example: |
    apiVersion: skupper.io/v1alpha1
    kind: Site
    metadata:
      name: east
      namespace: east
    spec:
      ingress: none
      routerCpuLimit: 2
  cli_example: |
    skupper init --site-name east --ingress none --router-cpu-limit 2
  groups:
    - name: site
      entries:
        - name: name
          type: string
          description: |
            A name of your choice for the Skupper site.
        - name: annotations
          type: List of strings
          description: |
            Annotations to add to Skupper pods.
        - name: labels
          type: List of strings
          description: |
            Labels to add to Skupper pods.
        - name: create-network-policy
          type: boolean
          description: |
            Create network policy to restrict access to Skupper services
            exposed through this site to the pods currently in the
            namespace.
        - name: enable-rest-api
          type: boolean
          description: |
            Enable REST API
    - name: ingress
      entries:
        - name: ingress
          default: route if available, else loadbalancer
          type: string
          choices: [route, loadbalancer, nodeport, nginx-ingress-v1, contour-http-proxy, ingress, none]
          description: |
            Setup Skupper ingress to one of
        - name: ingress-host
          default: null
          type: string
          description: |
            The hostname or alias by which the ingress route or proxy can
            be reached.
        - name: ingress-annotations
          type: List of strings
          description: |
            Annotations to add to skupper ingress
    - name: console
      entries:
        - name: console-enabled
          type: boolean
          description: |
            Enable skupper console must be used in conjunction with
            '--enable-flow-collector' flag
        - name: console-auth
          default: internal
          type: string
          choices: [internal, openshift, unsecured]
          description: |
            The user authentication method for the console.
        - name: console-user
          default: admin
          type: string
          description: |
            The console username when using internal authentication.
        - name: console-password
          default: "[generated]"
          type: string
          description: |
            The console password when using internal authentication.
        - name: console-ingress
          type: string
          choices: [route, loadbalancer, nodeport, nginx-ingress-v1, contour-http-proxy, ingress, none]
          description: |
            Determines if/how console is exposed outside cluster. If
            not specified uses value of --ingress.
    - name: service-sync
      entries:
        - name: service-sync-enabled
          default: y
          type: boolean
          description: |
            Participate in cross-site service synchronization
        - name: service-sync-site-ttl
          type: duration
          description: |
            Time after which stale services, i.e. those whose site has not been heard from, created through service-sync are removed.
    - name: config-sync
      entries:
        - name: config-sync-cpu
          type: string
          description: |
            CPU request for config-sync pods
        - name: config-sync-memory
          type: string
          description: |
            Memory request for config-sync pods
        - name: config-sync-cpu-limit
          type: string
          description: |
            CPU limit for config-sync pods
        - name: config-sync-memory-limit
          type: string
          description: |
            Memory limit for config-sync pods
    - name: controller
      entries:
        - name: controller-cpu
          type: string
          description: |
            CPU request for controller pods
        - name: controller-memory
          type: string
          description: |
            Memory request for controller pods
        - name: controller-cpu-limit
          type: string
          description: |
            CPU limit for controller pods
        - name: controller-memory-limit
          type: string
          description: |
            Memory limit for controller pods
        - name: controller-node-selector
          type: string
          description: |
            Node selector to control placement of controller pods.
        - name: controller-pod-affinity
          type: string
          description: |
            Pod affinity label matches to control placement of
            controller pods.
        - name: controller-pod-antiaffinity
          type: string
          description: |
            Pod antiaffinity label matches to control placement of
            controller pods.
        - name: controller-ingress-host
          type: string
          description: |
            The host through which the node is accessible when using
            nodeport as ingress.
        - name: controller-load-balancer-ip
          type: string
          description: |
            The load balancer IP that will be used for the controller
            service, if supported by cloud provider.
        - name: controller-service-annotations
          type: List of strings
          description: |
            Annotations to add to skupper controller service
    - name: flow-collector
      entries:
        - name: flow-collector-enabled
          type: boolean
          description: |
            Enable cross-site flow collection for the application network
        - name: flow-collector-record-ttl
          default: 30m
          type: duration
          description: |
            Time after which terminated flow records are deleted,
            i.e. those flow records that have an end time set.
        - name: flow-collector-cpu
          type: string
          description: |
            CPU request for flow collector pods
        - name: flow-collector-memory
          type: string
          description: |
            Memory request for flow collector pods
        - name: flow-collector-cpu-limit
          type: string
          description: |
            CPU limit for flow collector pods
        - name: flow-collector-memory-limit
          type: string
          description: |
            Memory limit for flow collector pods
    - name: router
      entries:
        - name: router-mode
          default: interior
          type: string
          choices: [interior, edge]
          description: |
            The role of the router in the router topology.  Interior
            routers do XXX.  Edge routers only do YYY.
        - name: router-logging
          default: info
          type: string
          choices: [trace, debug, info, notice, warning, error]
          description: |
            Logging settings for router
        - name: router-debug-mode
          type: string
          choices: [asan, gdb]
          description: |
            Enable debug mode for the router
        - name: routers
          type: integer
          description: |
            Number of router replicas to start
        - name: router-cpu
          type: string
          description: |
            CPU request for router pods
        - name: router-memory
          type: string
          description: |
            Memory request for router pods
        - name: router-cpu-limit
          type: string
          description: |
            CPU limit for router pods
        - name: router-memory-limit
          type: string
          description: |
            Memory limit for router pods
        - name: router-node-selector
          type: string
          description: |
            Node selector to control placement of router pods
        - name: router-pod-affinity
          type: string
          description: |
            Pod affinity label matches to control placement of router pods
        - name: router-pod-antiaffinity
          type: string
          description: |
            Pod antiaffinity label matches to control placement of router pods
        - name: router-ingress-host
          type: string
          description: |
            Host through which node is accessible when using nodeport as ingress.
        - name: router-load-balancer-ip
          type: string
          description: |
            Load balancer ip that will be used for router service, if supported by cloud provider
        - name: router-service-annotations
          type: List of strings
          description: |
            Annotations to add to skupper router service
- name: link
  yaml_example: |
    version: 1
    site:
      name: east
      links:
        - name: link-to-west
          secret: west-token-1.yaml
  kubernetes_example: |
    apiVersion: skupper.io/v1alpha1
    kind: Link
    metadata:
      name: link-to-west
      namespace: east
    spec:
      secret: west-token-1
  cli_example: |
    skupper link create west-token-1.yaml --name link-to-west
  entries:
    - name: name
      default: "[Generated]"
      type: string
      description: |
        An optional name for the link.
    - name: secret
      type: string
      description: |
        The path to the file or resource that contains the token data.
    - name: cost
      default: 1
      type: integer
      description: |
        The weighted cost of routing connections and requests over
        this link.  The cost of this link relative to others, plus the
        current backlog at each endpoint and the number of hops
        required, determines how traffic is routed across the network.
- name: token
  yaml_example: |
    version: 1
    site:
      name: west
      tokens:
        - name: west-token-1
          secret: west-token-1.yaml
          expiry: 1h
  kubernetes_example: |
    apiVersion: skupper.io/v1alpha1
    kind: Token
    metadata:
      name: west-token-1
      namespace: west
    spec:
      secret: west-token-1
      expiry: 1h
  cli_example: |
    skupper token create west-token-1.yaml --expiry 1h
  entries:
    - name: name
      default: "[Generated]"
      type: string
      description: |
        The name of the token.
    - name: secret
      type: string
      description: |
        The path to the file or resource that is to contain the
        generated token data.
    - name: type
      default: claim
      type: string
      choices: [claim, cert]
      description: |
        The type of token to create.
    - name: expiry
      default: 15m
      type: duration
      description: |
        The expiration time for the token.  Valid only if the token
        type is claim.
    - name: password
      default: [Generated]
      type: string
      description: |
        A password for the token.  Valid only if the token type is
        claim.
    - name: uses
      default: 1
      type: integer
      description: |
        The max number of uses the token allows.  Valid only if
        the token type is claim.
    - name: auth-name
      trouble: What does this mean?  I feel a more relatable attribute might be something linke remote-site-name.
      default: skupper (?)
      type: string
      description: |
        Provide a specific identity as which connecting skupper
        installation will be authenticated.
- name: provided-service
  yaml_example: |
    version: 1
    site:
      name: east
      provided-services:
        - name: backend
          target: deployment/backend
          ports:
            - port: 8080
              target-port: 9090
  kubernetes_example: |
    apiVersion: skupper.io/v1alpha1
    kind: ProvidedService
    metadata:
      name: backend
      namespace: east
    spec:
      target: deployment/backend
      ports:
        - port: 8080
          targetPort: 9090
  cli_example: |
    #
    # Current
    #
    skupper service create backend 8080
    skupper service bind backend deployment/backend --target-port 9090
    #
    # Proposed (general purpose form)
    #
    skupper provided-service create backend deployment/backend
    skupper provided-service create-port backend 8080 --target-port 9090
    #
    # Proposed (simplified form for the common case)
    #
    skupper provide backend:8080 deployment/backend --target-port 9090
  groups:
    - name: provided-service
      entries:
        - name: name
          type: string
          description: |
            The service name.
        - name: ports[]
          type: list
          description: |
            A list of ports.
        - name: target
          type: string
          description: |
            The workload that implements this service.
        - name: ingress-enabled
          trouble: |
            Collision with other meanings of "ingress".  I want a note
            here that says that some future iteration might include a
            third state.
          default: Always
          type: string
          choices: [Always, Never]
          description: |
            Determines whether access to the Skupper service is enabled in
            this site.
        - name: publish-not-ready-addresses
          type: boolean
          description: |
            If specified, skupper will not wait for pods to be ready
    - name: provided-service-port
      entries:
        - name: ports[].port
          type: integer
          description: |
            The port number.
        - name: ports[].name
          default: The value of ports[].port
          type: string
          description: |
            The port name.
        - name: ports[].protocol
          default: tcp
          type: string
          choices: [tcp, http, http2]
          description: |
            The protocol mapping in use for this service address.
        - name: ports[].target-port
          default: The value of ports[].port
          type: List of strings
          description: |
            The port the target is listening on (you can also use
            colon to map source-port to a target-port).
        - name: ports[].bridge-image
          type: string
          description: |
            The image to use for a bridge running external to the
            skupper router
    - name: provided-service-port-tls
      title: Provided service port TLS
      entries:
        - name: ports[].generate-tls-secrets
          trouble: This sounds like it generates secrets, but the description says it enables encryption
          type: boolean
          description: |
            If specified, the service communication will be encrypted using TLS
        - name: ports[].tls-cert
          type: string
          description: |
            The Kubernetes secret name with custom certificates to encrypt
            the communication using TLS.
        - name: ports[].tls-trust
          type: string
          description: |
            The Kubernetes secret name with the CA to expose the service
            over TLS.
    - name: provided-service-port-event
      entries:
        - name: ports[].event-channel-enabled
          trouble: I feel like having "multicast" in the name would be better
          type: boolean
          description: |
            If specified, this service will be a channel for multicast
            events.
        - name: ports[].response-aggregation-mode
          type: string
          choices: [json, multipart]
          description: |
            The aggregation strategy to use.  If specified requests to
            this service will be sent to all registered
            implementations and the responses aggregated.
- name: required-service
  yaml_example: |
    version: 1
    site:
      name: west
      required-services:
        - name: backend
          ports:
            - port: 8080
  kubernetes_example: |
    apiVersion: skupper.io/v1alpha1
    kind: RequiredService
    metadata:
      name: backend
      namespace: west
    spec:
      ports:
        - port: 8080
  cli_example: |
    #
    # Current
    #
    skupper service create backend 8080
    #
    # Proposed (general purpose form)
    #
    skupper required-service create backend
    skupper required-service create-port backend 8080
    #
    # Proposed (simplified form for the common case)
    #
    skupper require backend:8080
  groups:
    - name: required-service
      entries:
        - name: name
          type: string
          description: |
            The service name.
        - name: ports[]
          type: list
          description: |
            A list of ports.
        - name: publish-not-ready-addresses
          type: boolean
          description: |
            If specified, skupper will not wait for pods to be ready
    - name: required-service-port
      entries:
        - name: ports[].port
          type: integer
          description: |
            The port number.
        - name: ports[].name
          default: The value of ports[].port
          type: string
          description: |
            The port name.
        - name: ports[].protocol
          default: tcp
          type: string
          choices: [tcp, http, http2]
          description: |
            The protocol mapping in use for this service address.

            XXX Consequences for observability.
        - name: ports[].bridge-image
          type: string
          description: |
            The image to use for a bridge running external to the
            skupper router
    - name: required-service-port-tls
      title: Required service port TLS
      entries:
        - name: ports[].generate-tls-secrets
          trouble: This sounds like it generates secrets, but the description says it enables encryption
          type: boolean
          description: |
            If specified, the service communication will be encrypted using TLS
        - name: ports[].tls-cert
          type: string
          description: |
            The Kubernetes secret name with custom certificates to encrypt
            the communication using TLS.
        - name: ports[].tls-trust
          type: string
          description: |
            The Kubernetes secret name with the CA to expose the service
            over TLS.
    - name: required-service-port-event
      entries:
        - name: ports[].event-channel-enabled
          type: boolean
          description: |
            If specified, this service will be a channel for multicast
            events.
        - name: ports[].response-aggregation-mode
          type: string
          choices: [json, multipart]
          description: |
            The aggregation strategy to use.  If specified requests to
            this service will be sent to all registered
            implementations and the responses aggregated.
